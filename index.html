<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>8b8t Bot Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --bg: #0d1117; --card: #161b22; --border: #30363d; --accent: #58a6ff; --text: #c9d1d9; --green: #238636; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
        
        /* Header Stats */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: var(--card); border: 1px solid var(--border); padding: 15px; border-radius: 8px; text-align: center; }
        .stat-val { font-size: 24px; font-weight: bold; color: var(--accent); display: block; margin-top: 5px; }
        .stat-label { font-size: 12px; color: #8b949e; text-transform: uppercase; }

        /* Chat Box */
        .chat-container { background: #000; border: 1px solid var(--border); border-radius: 8px; height: 400px; overflow-y: auto; padding: 10px; font-family: 'Consolas', monospace; font-size: 14px; display: flex; flex-direction: column-reverse;}
        .chat-line { padding: 2px 0; border-bottom: 1px solid #1f1f1f; word-wrap: break-word; }
        .timestamp { color: #8b949e; margin-right: 5px; font-size: 12px; }

        /* Leaderboards */
        .leaderboard { background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 15px; margin-bottom: 20px; }
        .lb-header { font-size: 16px; font-weight: bold; margin-bottom: 10px; border-bottom: 1px solid var(--border); padding-bottom: 5px; color: #f0883e; }
        .lb-row { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #21262d; }
        .lb-row:last-child { border-bottom: none; }
        .lb-rank { width: 20px; color: #8b949e; }
        .lb-name { flex-grow: 1; }
        .lb-count { font-weight: bold; color: var(--green); }

        @media (max-width: 768px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <div class="stats-grid">
        <div class="stat-card"><span class="stat-label">Total Kits</span><span class="stat-val" id="totalKits">---</span></div>
        <div class="stat-card"><span class="stat-label">Today Kits</span><span class="stat-val" id="todayKits">---</span></div>
        <div class="stat-card"><span class="stat-label">Online</span><span class="stat-val" id="online">---</span></div>
        <div class="stat-card"><span class="stat-label">Peak (Day)</span><span class="stat-val" id="peak">---</span></div>
        <div class="stat-card"><span class="stat-label">TPS / Ping</span><span class="stat-val" id="perf">---</span></div>
    </div>

    <div class="container">
        <div>
            <div style="margin-bottom: 5px; font-weight: bold;">ðŸ“º Server Live Chat</div>
            <div class="chat-container" id="chatBox">
                <div class="chat-line" style="color: yellow;">Connecting to feed...</div>
            </div>
            <div style="font-size: 12px; color: #8b949e; margin-top: 5px;">Last Update: <span id="lastUpdate">...</span></div>
        </div>

        <div>
            <div class="leaderboard">
                <div class="lb-header"><i class="fas fa-trophy"></i> Top Kit Requesters</div>
                <div id="userLb">Loading...</div>
            </div>

            <div class="leaderboard">
                <div class="lb-header"><i class="fas fa-box-open"></i> Most Popular Kits</div>
                <div id="kitLb">Loading...</div>
            </div>
        </div>
    </div>

    <script>
        async function updateDashboard() {
            try {
                // ThÃªm timestamp Ä‘á»ƒ trÃ¡nh cache
                const res = await fetch('stats.json?t=' + Date.now());
                if (!res.ok) return;
                const data = await res.json();

                // 1. Update Top Stats
                document.getElementById('totalKits').innerText = data.totalKits;
                document.getElementById('todayKits').innerText = data.todayKits;
                document.getElementById('online').innerText = data.onlineCount;
                document.getElementById('peak').innerText = data.peakPlayers;
                document.getElementById('perf').innerText = `${data.tps} / ${data.ping}ms`;
                document.getElementById('lastUpdate').innerText = data.lastUpdated;

                // 2. Update Chat (Hiá»ƒn thá»‹ ngÆ°á»£c tá»« dÆ°á»›i lÃªn)
                const chatHtml = data.chatLog.slice().reverse().map(line => {
                    // Highlight commands or bot msg
                    let style = '';
                    if(line.includes('>')) style = 'color: #79c0ff;'; // Bot msg
                    if(line.includes('!kit')) style = 'color: #d2a8ff;'; // Command
                    return `<div class="chat-line" style="${style}">${line}</div>`;
                }).join('');
                document.getElementById('chatBox').innerHTML = chatHtml;

                // 3. Update User Leaderboard
                const userHtml = data.topUsers.map((u, i) => `
                    <div class="lb-row">
                        <span class="lb-rank">#${i+1}</span>
                        <span class="lb-name">${u.name}</span>
                        <span class="lb-count">${u.count}</span>
                    </div>
                `).join('');
                document.getElementById('userLb').innerHTML = userHtml || '<div style="text-align:center;color:#8b949e">No data</div>';

                // 4. Update Kit Leaderboard
                const kitHtml = data.topKits.map((k, i) => `
                    <div class="lb-row">
                        <span class="lb-rank">#${i+1}</span>
                        <span class="lb-name" style="text-transform: capitalize;">${k.name}</span>
                        <span class="lb-count">${k.count}</span>
                    </div>
                `).join('');
                document.getElementById('kitLb').innerHTML = kitHtml || '<div style="text-align:center;color:#8b949e">No data</div>';

            } catch (err) { console.error(err); }
        }

        updateDashboard();
        setInterval(updateDashboard, 30000); // F5 má»—i 30s
    </script>
</body>
</html>
